document.addEventListener("DOMContentLoaded",function(){const q=isRtl?"rtl":"ltr";(function(){const B=document.getElementById("calendar"),w=document.querySelector(".app-calendar-sidebar"),T=document.getElementById("addEventSidebar"),D=document.querySelector(".app-overlay"),o=document.querySelector(".offcanvas-title"),L=document.querySelector(".btn-toggle-sidebar"),l=document.getElementById("addEventBtn"),f=document.querySelector(".btn-delete-event"),I=document.querySelector(".btn-cancel"),p=document.getElementById("eventTitle"),d=document.getElementById("eventStartDate"),s=document.getElementById("eventEndDate"),g=document.getElementById("eventURL"),b=document.getElementById("eventLocation"),h=document.getElementById("eventDescription"),v=document.querySelector(".allDay-switch"),y=document.querySelector(".select-all"),x=Array.from(document.querySelectorAll(".input-filter")),P=document.querySelector(".inline-calendar"),F={Business:"primary",Holiday:"success",Personal:"danger",Family:"warning",ETC:"info"},c=$("#eventLabel"),i=$("#eventGuests");let u=events,E=!1,n=null,A=null;const m=new bootstrap.Offcanvas(T);//! TODO: Update Event label and guest code to JS once select removes jQuery dependency
if(c.length){let e=function(t){if(!t.id)return t.text;var a="<span class='badge badge-dot bg-"+$(t.element).data("label")+" me-2'> </span>"+t.text;return a};var _=e;select2Focus(c),c.select2({placeholder:"Select value",dropdownParent:c.parent(),templateResult:e,templateSelection:e,minimumResultsForSearch:-1,escapeMarkup:function(t){return t}})}if(i.length){let e=function(t){return t.id?`
<div class='d-flex flex-wrap align-items-center'>
<div class='avatar avatar-xs me-2'>
<img src='${assetsPath}img/avatars/${$(t.element).data("avatar")}'
alt='avatar' class='rounded-circle' />
</div>
      ${t.text}
</div>`:t.text};var z=e;select2Focus(i),i.select2({placeholder:"Select value",dropdownParent:i.parent(),closeOnSelect:!1,templateResult:e,templateSelection:e,escapeMarkup:function(t){return t}})}if(d)var Y=d.flatpickr({monthSelectorType:"static",static:!0,enableTime:!0,altFormat:"Y-m-dTH:i:S",onReady:function(e,t,a){a.isMobile&&a.mobileInput.setAttribute("step",null)}});if(s)var M=s.flatpickr({monthSelectorType:"static",static:!0,enableTime:!0,altFormat:"Y-m-dTH:i:S",onReady:function(e,t,a){a.isMobile&&a.mobileInput.setAttribute("step",null)}});P&&(A=P.flatpickr({monthSelectorType:"static",static:!0,inline:!0}));function H(e){n=e.event,n.url&&(e.jsEvent.preventDefault(),window.open(n.url,"_blank")),m.show(),o&&(o.innerHTML="Update Event"),l.innerHTML="Update",l.classList.add("btn-update-event"),l.classList.remove("btn-add-event"),f.classList.remove("d-none"),p.value=n.title,Y.setDate(n.start,!0,"Y-m-d"),n.allDay===!0?v.checked=!0:v.checked=!1,n.end!==null?M.setDate(n.end,!0,"Y-m-d"):M.setDate(n.start,!0,"Y-m-d"),c.val(n.extendedProps.calendar).trigger("change"),n.extendedProps.location!==void 0&&(b.value=n.extendedProps.location),n.extendedProps.guests!==void 0&&i.val(n.extendedProps.guests).trigger("change"),n.extendedProps.description!==void 0&&(h.value=n.extendedProps.description)}function S(){const e=document.querySelector(".fc-sidebarToggle-button"),t=document.querySelector(".fc-prev-button"),a=document.querySelector(".fc-next-button"),k=document.querySelector(".fc-header-toolbar");for(t.classList.add("btn","btn-sm","btn-icon","btn-outline-secondary","me-2"),a.classList.add("btn","btn-sm","btn-icon","btn-outline-secondary","me-4"),k.classList.add("row-gap-4","gap-2"),e.classList.remove("fc-button-primary"),e.classList.add("d-lg-none","d-inline-block","ps-0");e.firstChild;)e.firstChild.remove();e.setAttribute("data-bs-toggle","sidebar"),e.setAttribute("data-overlay",""),e.setAttribute("data-target","#app-calendar-sidebar"),e.insertAdjacentHTML("beforeend",'<i class="icon-base ri ri-menu-line icon-24px text-body"></i>')}function V(){let e=[];return[].slice.call(document.querySelectorAll(".input-filter:checked")).forEach(a=>{e.push(a.getAttribute("data-value"))}),e}function R(e,t){let a=V(),k=u.filter(function(j){return a.includes(j.extendedProps.calendar.toLowerCase())});t(k)}let r=new Calendar(B,{initialView:"dayGridMonth",events:R,plugins:[dayGridPlugin,interactionPlugin,listPlugin,timegridPlugin],editable:!0,dragScroll:!0,dayMaxEvents:2,eventResizableFromStart:!0,customButtons:{sidebarToggle:{text:"Sidebar"}},headerToolbar:{start:"sidebarToggle, prev,next, title",end:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},direction:q,initialDate:new Date,navLinks:!0,eventClassNames:function({event:e}){return["bg-label-"+F[e._def.extendedProps.calendar]]},dateClick:function(e){let t=moment(e.date).format("YYYY-MM-DD");C(),m.show(),o&&(o.innerHTML="Add Event"),l.innerHTML="Add",l.classList.remove("btn-update-event"),l.classList.add("btn-add-event"),f.classList.add("d-none"),d.value=t,s.value=t},eventClick:function(e){H(e)},datesSet:function(){S()},viewDidMount:function(){S()}});r.render(),S();const G=document.getElementById("eventForm");FormValidation.formValidation(G,{fields:{eventTitle:{validators:{notEmpty:{message:"Please enter event title "}}},eventStartDate:{validators:{notEmpty:{message:"Please enter start date "}}},eventEndDate:{validators:{notEmpty:{message:"Please enter end date "}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(e,t){return".form-control-validation"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){E=!0}).on("core.form.invalid",function(){E=!1}),L&&L.addEventListener("click",e=>{I.classList.remove("d-none")});function U(e){u.push(e),r.refetchEvents()}function N(e){e.id=parseInt(e.id),u[u.findIndex(t=>t.id===e.id)]=e,r.refetchEvents()}function O(e){u=u.filter(function(t){return t.id!=e}),r.refetchEvents()}l.addEventListener("click",e=>{if(l.classList.contains("btn-add-event")){if(E){let t={id:r.getEvents().length+1,title:p.value,start:d.value,end:s.value,startStr:d.value,endStr:s.value,display:"block",extendedProps:{location:b.value,guests:i.val(),calendar:c.val(),description:h.value}};g.value&&(t.url=g.value),v.checked&&(t.allDay=!0),U(t),m.hide()}}else if(E){let t={id:n.id,title:p.value,start:d.value,end:s.value,url:g.value,extendedProps:{location:b.value,guests:i.val(),calendar:c.val(),description:h.value},display:"block",allDay:!!v.checked};N(t),m.hide()}}),f.addEventListener("click",e=>{O(parseInt(n.id)),m.hide()});function C(){s.value="",g.value="",d.value="",p.value="",b.value="",v.checked=!1,i.val("").trigger("change"),h.value=""}T.addEventListener("hidden.bs.offcanvas",function(){C()}),L.addEventListener("click",e=>{o&&(o.innerHTML="Add Event"),l.innerHTML="Add",l.classList.remove("btn-update-event"),l.classList.add("btn-add-event"),f.classList.add("d-none"),w.classList.remove("show"),D.classList.remove("show")}),y&&y.addEventListener("click",e=>{e.currentTarget.checked?document.querySelectorAll(".input-filter").forEach(t=>t.checked=1):document.querySelectorAll(".input-filter").forEach(t=>t.checked=0),r.refetchEvents()}),x&&x.forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".input-filter:checked").length<document.querySelectorAll(".input-filter").length?y.checked=!1:y.checked=!0,r.refetchEvents()})}),A.config.onChange.push(function(e){r.changeView(r.view.type,moment(e[0]).format("YYYY-MM-DD")),S(),w.classList.remove("show"),D.classList.remove("show")})})()});
