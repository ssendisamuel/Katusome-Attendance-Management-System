import{p as B,a as E}from"./vfs_fonts-C3tGlUsD.js";import{E as I}from"./exceljs.min-C3zYEaiS.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";try{E.vfs=B&&B.pdfMake&&B.pdfMake.vfs||E.vfs||{}}catch{}function P(s){const d=Array.from(s.querySelectorAll("thead th")).map(r=>r.innerText.trim()),e=Array.from(s.querySelectorAll("tbody tr")).map(r=>Array.from(r.children).map(f=>f.innerText.trim()));return[d,...e]}async function T(s){try{const l=await fetch(s,{headers:{Accept:"application/json"}});if(!l.ok)throw new Error(`HTTP ${l.status}`);return await l.json()}catch(l){return console.error("ReportExport: JSON fetch failed",l),null}}async function q(s){try{const l=await fetch(s,{cache:"force-cache"});if(!l.ok)throw new Error(`HTTP ${l.status}`);const d=await l.blob();return await new Promise(e=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.readAsDataURL(d)})}catch(l){return console.warn("ReportExport: logo fetch failed",l),null}}async function D({tableSelector:s,title:l="Report",filename:d=null,jsonUrl:e=null}){let r=[],f=[],o={},i={},g=l;if(e){const a=await T(e);a&&a.columns&&a.rows&&(r=a.columns,f=a.rows,o=a.meta||{},i=a.summary||a.metrics||{},g=a.title||l)}if(!r.length||!f.length){const a=document.querySelector(s);if(!a){console.warn("ReportExport: table not found for selector",s);return}const w=P(a);r=w[0]||[],f=w.slice(1)}const h=new I.Workbook;h.creator=o.generatedBy||"Katusome Attendance",h.created=new Date,h.modified=new Date;const x=(g||"Report").slice(0,31),n=h.addWorksheet(x,{properties:{defaultRowHeight:18}}),y=Math.max(r.length,1),c=a=>n.mergeCells(a,1,a,y);let t=1;const u=o.institution||"Makerere University Business School";n.getCell(t,1).value=u,n.getCell(t,1).font={bold:!0,size:14,color:{argb:"FF333333"}},n.getCell(t,1).alignment={horizontal:"center"},c(t),t++;const b=o.system||"Katusome Attendance Management System";n.getCell(t,1).value=b,n.getCell(t,1).font={size:12,color:{argb:"FF555555"}},n.getCell(t,1).alignment={horizontal:"center"},c(t),t++,o.faculty&&(n.getCell(t,1).value=o.faculty,n.getCell(t,1).font={size:10,color:{argb:"FF777777"}},n.getCell(t,1).alignment={horizontal:"center"},c(t),t++);const R=(g||"Report").toUpperCase();n.getCell(t,1).value=R,n.getCell(t,1).font={bold:!0,size:13},n.getCell(t,1).alignment={horizontal:"center"},n.getCell(t,1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF3F5F7"}},c(t),t++;const p=[];o.course&&p.push(`Course: ${o.course}`),o.group&&p.push(`Group: ${o.group}`),p.length&&(n.getCell(t,1).value=p.join(" | "),n.getCell(t,1).font={size:9,color:{argb:"FF777777"}},c(t),t++);const S=[];o.dateRange&&S.push(`Date: ${o.dateRange}`),o.lecturer&&S.push(`Lecturer: ${o.lecturer}`),S.length&&(n.getCell(t,1).value=S.join(" | "),n.getCell(t,1).font={size:9,color:{argb:"FF777777"}},c(t),t++);const z=[];o.generatedOn&&z.push(`Generated On: ${o.generatedOn}`),o.generatedBy&&z.push(`Generated By: ${o.generatedBy}`),z.length&&(n.getCell(t,1).value=z.join(" | "),n.getCell(t,1).font={size:9,color:{argb:"FF777777"}},c(t),t++);const C=[];o.academicYear&&C.push(`Academic Year ${o.academicYear}`),o.semester&&C.push(`Semester ${o.semester}`),o.reportId&&C.push(`Report ID: ${o.reportId}`),C.length&&(n.getCell(t,1).value=C.join(" | "),n.getCell(t,1).font={size:9,color:{argb:"FF777777"}},c(t),t++);const m=[];if(i.expected!=null&&m.push(`Total Expected: ${i.expected}`),i.present!=null&&m.push(`Present: ${i.present}`),i.late!=null&&m.push(`Late: ${i.late}`),i.absent!=null&&m.push(`Absent: ${i.absent}`),i.rate!=null&&m.push(`Rate: ${i.rate}%`),m.length){const a=n.addRow(m);a.font={size:10},t++}t++;const L=t,F=n.addRow(r);F.font={bold:!0},F.alignment={horizontal:"center"},F.eachCell(a=>{a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFEFEF"}},a.border={top:{style:"thin",color:{argb:"FFCCCCCC"}},bottom:{style:"thin",color:{argb:"FFCCCCCC"}}}}),f.forEach(a=>{const w=n.addRow(a);w.height=18}),n.columns=r.map((a,w)=>{const $=[a,...f.map(A=>A[w]!=null?String(A[w]):"")].reduce((A,O)=>Math.max(A,O.length),0);return{key:`col${w}`,width:Math.min(Math.max(10,$+2),40)}}),n.views=[{state:"frozen",ySplit:L}];const U=d||`${(g||"Report").replace(/\s+/g,"_")}.xlsx`;try{const a=await h.xlsx.writeBuffer(),w=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=URL.createObjectURL(w),$=document.createElement("a");$.href=v,$.download=U,document.body.appendChild($),$.click(),document.body.removeChild($),setTimeout(()=>URL.revokeObjectURL(v),1e3)}catch(a){console.error("ReportExport: Excel generation failed",a)}}async function G({title:s,columns:l,rows:d,meta:e={},summary:r={},orientation:f="landscape",branding:o=null,filename:i=null}){const g=l?l.map(()=>"*"):[],h=new Date,x=(o==null?void 0:o.footerLeft)??((e==null?void 0:e.exportNote)||"This report is system-generated. Unauthorized distribution is prohibited.");(o==null?void 0:o.footerRight)??`${h.toLocaleString()}`;let n=null;e.logo&&(n=await q(e.logo));const y=[];(n||e.institution||e.system||e.faculty)&&y.push({columns:[n?{image:n,width:48}:{text:"",width:48},{stack:[{text:e.institution||"Makerere University Business School",style:"brand"},{text:e.system||"Katusome Attendance Management System",style:"subBrand"},e.faculty?{text:e.faculty,style:"subtle"}:null].filter(Boolean),alignment:"left"},{text:"",width:"*"}],margin:[0,0,0,6]}),y.push({text:(s||e.title||"Report").toUpperCase(),style:"header",alignment:"center",margin:[0,4,0,4]}),y.push({canvas:[{type:"line",x1:0,y1:0,x2:515,y2:0,lineWidth:.5}],margin:[0,2,0,6]});const c=[],t=[];e.course&&t.push(`Course: ${e.course}`),e.group&&t.push(`Group: ${e.group}`),t.length&&c.push({text:t.join(" | "),style:"context"});const u=[];e.dateRange&&u.push(`Date: ${e.dateRange}`),e.lecturer&&u.push(`Lecturer: ${e.lecturer}`),u.length&&c.push({text:u.join(" | "),style:"context"});const b=[];e.generatedOn&&b.push(`Generated On: ${e.generatedOn}`),e.generatedBy&&b.push(`Generated By: ${e.generatedBy}`),b.length&&c.push({text:b.join(" | "),style:"context"});const R=[];e.academicYear&&R.push(`Academic Year ${e.academicYear}`),e.semester&&R.push(`Semester ${e.semester}`),e.reportId&&R.push(`Report ID: ${e.reportId}`),R.length&&c.push({text:R.join(" | "),style:"context"});const p=[];r.expected!=null&&p.push({text:`Total Expected: ${r.expected}`,bold:!0}),r.present!=null&&p.push({text:`Present: ${r.present}`}),r.late!=null&&p.push({text:`Late: ${r.late}`}),r.absent!=null&&p.push({text:`Absent: ${r.absent}`}),r.rate!=null&&p.push({text:`Rate: ${r.rate}%`});const S=[...y,...c,{canvas:[{type:"line",x1:0,y1:0,x2:515,y2:0,lineWidth:.5}],margin:[0,4,0,6]},p.length?{columns:p,margin:[0,0,0,8]}:null,{canvas:[{type:"line",x1:0,y1:0,x2:515,y2:0,lineWidth:.5}],margin:[0,4,0,6]},{table:{headerRows:1,widths:g,body:[l,...d]},layout:"lightHorizontalLines"}].filter(Boolean),z={info:{title:s||e.title||"Report"},pageSize:"A4",pageOrientation:f,pageMargins:[30,30,30,30],content:S,styles:{brand:{fontSize:12,bold:!0,color:"#333"},subBrand:{fontSize:10,color:"#555"},subtle:{fontSize:9,color:"#777"},header:{fontSize:14,bold:!0},context:{fontSize:9}},defaultStyle:{font:"Roboto",fontSize:9},footer:function(m,L){return{stack:[{text:`${e.institution||"Makerere University Business School"} | ${e.email||"attendance@mubs.ac.ug"} | ${e.website||"https://katusome.ssendi.dev"}`,alignment:"center",fontSize:8},{columns:[{text:`${x}`,alignment:"left",fontSize:7},{text:`Page ${m} of ${L}`,alignment:"right",fontSize:8}]}],margin:[30,0]}}},C=i||`${(s||e.title||"Report").replace(/\s+/g,"_")}.pdf`;try{E.createPdf(z).download(C)}catch(m){console.error("ReportExport: PDF generation failed",m)}}async function M({tableSelector:s,title:l="Report",filename:d=null,orientation:e="landscape",branding:r=null,jsonUrl:f=null}){const o=document.querySelector(s);if(!o){console.warn("ReportExport: table not found for selector",s);return}const i=P(o);if(f){const u=await T(f);if(u&&u.columns&&u.rows){const b=u.meta||{},R=u.summary||u.metrics||{},p=u.title||l;return G({title:p,columns:u.columns,rows:u.rows,meta:b,summary:R,orientation:e,branding:r,filename:d})}}const g=i[0]?i[0].map(()=>"*"):[],h=new Date,x=(r==null?void 0:r.footerLeft)??"Generated by Katusome",n=(r==null?void 0:r.footerRight)??h.toLocaleString(),y=(r==null?void 0:r.header)??null,c={info:{title:l},pageSize:"A4",pageOrientation:e,pageMargins:[30,30,30,30],content:[y?{text:y,style:"brand",margin:[0,0,0,2]}:null,{text:l,style:"header",margin:[0,0,0,10]},{table:{headerRows:1,widths:g,body:i},layout:"lightHorizontalLines"}],styles:{brand:{fontSize:12,bold:!0,color:"#333"},header:{fontSize:14,bold:!0},tableHeader:{bold:!0}},defaultStyle:{font:"Roboto",fontSize:9},footer:function(u,b){return{columns:[{text:`${x}`,alignment:"left",fontSize:8},{text:`Page ${u} of ${b} â€¢ ${n}`,alignment:"right",fontSize:8}],margin:[30,0]}}},t=d||`${l.replace(/\s+/g,"_")}.pdf`;try{E.createPdf(c).download(t)}catch(u){console.error("ReportExport: PDF generation failed",u)}}function j(){try{window.print()}catch(s){console.error("ReportExport: print failed",s)}}function _(){window.__reportExportInitialized||(window.__reportExportInitialized=!0,document.addEventListener("click",function(s){var r,f;const l=s.target.closest('[data-export="pdf"]');if(l){let o=l.getAttribute("data-export-target");const i=l.getAttribute("data-title")||document.title||"Report",g=l.getAttribute("data-filename"),h=l.getAttribute("data-orientation")||"landscape",x=l.getAttribute("data-json-url"),n={header:l.getAttribute("data-header")||((f=(r=document.querySelector(".app-brand"))==null?void 0:r.textContent)==null?void 0:f.trim())||null,footerLeft:l.getAttribute("data-footer-left")||"Katusome Attendance",footerRight:l.getAttribute("data-footer-right")||null};if(!o){const y=l.closest(".card, .container, .content-wrapper, body"),c=y?y.querySelector("table"):document.querySelector("table");c&&c.id?o=`#${c.id}`:o="table"}M({tableSelector:o,title:i,filename:g,orientation:h,branding:n,jsonUrl:x});return}const d=s.target.closest('[data-export="excel"]');if(d){let o=d.getAttribute("data-export-target");const i=d.getAttribute("data-title")||document.title||"Report",g=d.getAttribute("data-filename"),h=d.getAttribute("data-json-url");if(!o){const x=d.closest(".card, .container, .content-wrapper, body"),n=x?x.querySelector("table"):document.querySelector("table");n&&n.id?o=`#${n.id}`:o="table"}D({tableSelector:o,title:i,filename:g,jsonUrl:h});return}if(s.target.closest('[data-export="print"]')){j();return}}))}const k={init:_,exportPdfFromTable:M,exportExcelFromTable:D,printPage:j};window.ReportExport=k;try{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{try{k.init()}catch{}}):k.init()}catch{}
